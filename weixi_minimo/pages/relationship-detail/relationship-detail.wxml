<!--å…³ç³»è¯¦æƒ…é¡µé¢-->
<scroll-view class="relationship-detail-page {{themeClass}}" scroll-y="{{true}}" bindscroll="onPageScroll" enhanced="{{true}}" show-scrollbar="{{false}}">
  
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-top">
      <text class="back-button" bindtap="onBack">â€¹ è¿”å›</text>
      <text class="page-title">å…³ç³»è¯¦æƒ…</text>
      <view class="header-actions">
        <view class="action-btn" bindtap="onShare">
          <t-icon name="share" size="24rpx" color="var(--td-text-color-secondary, #757575)" />
        </view>
      </view>
    </view>
  </view>
  
  <!-- å…³ç³»æ¦‚è§ˆå¡ç‰‡ -->
  <view class="relationship-overview" wx:if="{{relationship}}">
    <view class="overview-card">
      <!-- è”ç³»äººä¿¡æ¯ -->
      <view class="contacts-section">
        <view class="contact-item source">
          <view class="contact-avatar">
            <text class="avatar-text">{{relationship.sourceInitial}}</text>
          </view>
          <view class="contact-info">
            <text class="contact-name">{{relationship.sourceName}}</text>
            <text class="contact-subtitle">{{relationship.sourceCompany}}</text>
          </view>
        </view>
        
        <!-- å…³ç³»è¿æ¥çº¿ -->
        <view class="relationship-connector">
          <view class="connector-line"></view>
          <view class="connector-center">
            <view class="relationship-badge {{relationship.status}}">
              <text class="badge-icon">{{getRelationshipIcon(relationship.relationship_type)}}</text>
            </view>
            <text class="relationship-label">{{formatRelationshipType(relationship.relationship_type)}}</text>
          </view>
          <view class="connector-line"></view>
        </view>
        
        <view class="contact-item target">
          <view class="contact-avatar">
            <text class="avatar-text">{{relationship.targetInitial}}</text>
          </view>
          <view class="contact-info">
            <text class="contact-name">{{relationship.targetName}}</text>
            <text class="contact-subtitle">{{relationship.targetCompany}}</text>
          </view>
        </view>
      </view>
      
      <!-- å…³ç³»çŠ¶æ€å’Œå¯ä¿¡åº¦ -->
      <view class="relationship-metrics">
        <view class="metric-item">
          <text class="metric-label">çŠ¶æ€</text>
          <view class="status-badge {{relationship.status}}">
            <text class="status-text">{{formatStatus(relationship.status)}}</text>
          </view>
        </view>
        <view class="metric-item">
          <text class="metric-label">å¯ä¿¡åº¦</text>
          <view class="confidence-bar">
            <view class="confidence-fill" style="width: {{relationship.confidence_score * 100}}%"></view>
            <text class="confidence-text">{{Math.round(relationship.confidence_score * 100)}}%</text>
          </view>
        </view>
        <view class="metric-item">
          <text class="metric-label">å‘ç°æ—¶é—´</text>
          <text class="metric-value">{{formatDate(relationship.created_at)}}</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- å…³ç³»è¯æ® -->
  <view class="evidence-section" wx:if="{{relationship && relationship.evidence}}">
    <view class="section-header">
      <text class="section-title">å…³ç³»è¯æ®</text>
      <text class="section-subtitle">åŸºäºä»¥ä¸‹ä¿¡æ¯å‘ç°æ­¤å…³ç³»</text>
    </view>
    
    <view class="evidence-cards">
      <view wx:for="{{evidenceList}}" wx:key="field" class="evidence-card">
        <view class="evidence-header">
          <view class="evidence-icon">
            <text class="icon-text">{{getEvidenceIcon(item.field)}}</text>
          </view>
          <text class="evidence-title">{{getEvidenceTitle(item.field)}}</text>
          <view class="evidence-match-score">
            <text class="score-text">{{item.match_score}}%</text>
          </view>
        </view>
        <view class="evidence-content">
          <view class="evidence-comparison">
            <view class="comparison-item">
              <text class="comparison-label">{{relationship.sourceName}}</text>
              <text class="comparison-value">{{item.source_value}}</text>
            </view>
            <view class="comparison-divider">â‰ˆ</view>
            <view class="comparison-item">
              <text class="comparison-label">{{relationship.targetName}}</text>
              <text class="comparison-value">{{item.target_value}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ™ºèƒ½åˆ†æ -->
  <view class="analysis-section" wx:if="{{relationship && relationship.ai_analysis}}">
    <view class="section-header">
      <text class="section-title">æ™ºèƒ½åˆ†æ</text>
      <text class="section-subtitle">AIç”Ÿæˆçš„å…³ç³»æ´å¯Ÿ</text>
    </view>
    
    <view class="analysis-card">
      <view class="analysis-content">
        <text class="analysis-text">{{relationship.ai_analysis}}</text>
      </view>
      <view class="analysis-tags" wx:if="{{relationship.analysis_tags}}">
        <view wx:for="{{relationship.analysis_tags}}" wx:key="*this" class="analysis-tag">
          <text class="tag-text">{{item}}</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- ç›¸å…³æ—¶é—´çº¿ -->
  <view class="timeline-section" wx:if="{{timeline.length > 0}}">
    <view class="section-header">
      <text class="section-title">å…³ç³»æ—¶é—´çº¿</text>
      <text class="section-subtitle">ç›¸å…³å†å²è®°å½•</text>
    </view>
    
    <view class="timeline-container">
      <view wx:for="{{timeline}}" wx:key="id" class="timeline-item">
        <view class="timeline-dot {{item.type}}"></view>
        <view class="timeline-content">
          <text class="timeline-title">{{item.title}}</text>
          <text class="timeline-desc">{{item.description}}</text>
          <text class="timeline-time">{{formatDateTime(item.timestamp)}}</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- ç›¸å…³å»ºè®® -->
  <view class="suggestions-section" wx:if="{{suggestions.length > 0}}">
    <view class="section-header">
      <text class="section-title">ç›¸å…³å»ºè®®</text>
      <text class="section-subtitle">åŸºäºæ­¤å…³ç³»çš„è¡ŒåŠ¨å»ºè®®</text>
    </view>
    
    <view class="suggestions-cards">
      <view wx:for="{{suggestions}}" wx:key="id" class="suggestion-card" bindtap="onSuggestionTap" data-suggestion="{{item}}">
        <view class="suggestion-icon">
          <text class="icon-text">{{item.icon}}</text>
        </view>
        <view class="suggestion-content">
          <text class="suggestion-title">{{item.title}}</text>
          <text class="suggestion-desc">{{item.description}}</text>
        </view>
        <view class="suggestion-arrow">
          <t-icon name="chevron-right" size="20rpx" color="var(--td-text-color-placeholder, #bdbdbd)" />
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons" wx:if="{{relationship && relationship.status === 'discovered'}}">
    <button class="action-btn secondary" bindtap="onIgnoreRelationship">
      <t-icon name="close" size="24rpx" />
      <text class="btn-text">å¿½ç•¥å…³ç³»</text>
    </button>
    <button class="action-btn primary" bindtap="onConfirmRelationship">
      <t-icon name="check" size="24rpx" />
      <text class="btn-text">ç¡®è®¤å…³ç³»</text>
    </button>
  </view>
  
  <!-- å·²å¤„ç†çŠ¶æ€æ˜¾ç¤º -->
  <view class="status-display" wx:if="{{relationship && relationship.status !== 'discovered'}}">
    <view class="status-icon {{relationship.status}}">
      <text class="icon-text">{{relationship.status === 'confirmed' ? 'âœ“' : 'âœ•'}}</text>
    </view>
    <text class="status-message">
      {{relationship.status === 'confirmed' ? 'æ­¤å…³ç³»å·²ç¡®è®¤' : 'æ­¤å…³ç³»å·²å¿½ç•¥'}}
    </text>
    <text class="status-time">{{formatDateTime(relationship.updated_at)}}</text>
  </view>
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <t-loading theme="spinner" size="60rpx" />
    <text class="loading-text">åŠ è½½å…³ç³»è¯¦æƒ…ä¸­...</text>
  </view>
  
  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{error && !loading}}">
    <text class="error-message">{{error}}</text>
    <button class="retry-btn" bindtap="loadRelationshipDetail">
      <text class="btn-text">é‡æ–°åŠ è½½</text>
    </button>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && !error && !relationship}}">
    <view class="empty-icon">
      <text class="icon-text">ğŸ”—</text>
    </view>
    <text class="empty-title">æ‰¾ä¸åˆ°å…³ç³»ä¿¡æ¯</text>
    <text class="empty-desc">è¯¥å…³ç³»å¯èƒ½å·²è¢«åˆ é™¤æˆ–ä¸å­˜åœ¨</text>
  </view>
</scroll-view>