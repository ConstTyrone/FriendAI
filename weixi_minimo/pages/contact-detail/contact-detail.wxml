<!--联系人详情页面-->
<view class="detail-page {{themeClass}}">
  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 错误状态 -->
  <view class="error-state" wx:if="{{error && !loading}}">
    <text class="error-message">{{error}}</text>
    <view class="error-action" bind:tap="initPageData">
      <text class="action-text">重新加载</text>
    </view>
  </view>

  <!-- 联系人详情内容 -->
  <view class="detail-content" wx:if="{{contactInfo && !loading && !error}}">
    <!-- 头部信息 -->
    <view class="header-section">
      <!-- 右上角电话按钮 -->
      <view class="header-phone-btn" wx:if="{{contactInfo.phone}}" bind:tap="onCallPhone">
        <text class="phone-icon">📞</text>
      </view>
      
      <view class="header-avatar">
        <text class="avatar-text">{{contactInfo.initial}}</text>
      </view>
      
      <view class="header-info">
        <text class="header-name">{{contactInfo.profile_name || contactInfo.name || '未知'}}</text>
        <text class="header-company" wx:if="{{contactInfo.company}}">
          {{contactInfo.company}}
        </text>
        <text class="header-position" wx:if="{{contactInfo.position}}">
          {{contactInfo.position}}
        </text>
      </view>
    </view>

    <!-- 基本信息 -->
    <view class="info-section">
      <text class="section-title">基本信息</text>
      <view class="info-list">
        <view class="info-item" wx:if="{{contactInfo.phone}}">
          <text class="info-label">电话</text>
          <text class="info-value">{{contactInfo.phone}}</text>
        </view>
        
        <view class="info-item" wx:if="{{contactInfo.gender}}">
          <text class="info-label">性别</text>
          <text class="info-value">{{contactInfo.gender}}</text>
        </view>
        
        <view class="info-item" wx:if="{{contactInfo.age}}">
          <text class="info-label">年龄</text>
          <text class="info-value">{{contactInfo.age}}</text>
        </view>
      </view>
    </view>

    <!-- 工作信息 -->
    <view 
      class="info-section"
      wx:if="{{contactInfo.company || contactInfo.position}}"
    >
      <text class="section-title">工作信息</text>
      <view class="info-list">
        <view class="info-item" wx:if="{{contactInfo.company}}">
          <text class="info-label">公司</text>
          <text class="info-value">{{contactInfo.company}}</text>
        </view>
        
        <view class="info-item" wx:if="{{contactInfo.position}}">
          <text class="info-label">职务</text>
          <text class="info-value">{{contactInfo.position}}</text>
        </view>
      </view>
    </view>

    <!-- AI描述 -->
    <view 
      class="info-section ai-section"
      wx:if="{{contactInfo.ai_summary}}"
    >
      <text class="section-title">AI描述</text>
      <view class="ai-content">
        <text class="ai-text">{{contactInfo.ai_summary}}</text>
      </view>
    </view>

    <!-- 时间信息 -->
    <view class="time-info">
      <text class="time-text">创建于 {{formatDate(contactInfo.created_at)}}</text>
      <text class="time-text" wx:if="{{contactInfo.updated_at}}">更新于 {{formatDate(contactInfo.updated_at)}}</text>
    </view>
  </view>

  <!-- 底部操作栏 -->
  <view class="bottom-bar" wx:if="{{contactInfo && !loading && !error}}">
    <view class="bar-button" bind:tap="onEditContact">
      <text class="bar-text">编辑</text>
    </view>
    <view class="bar-button delete" bind:tap="onDeleteContact">
      <text class="bar-text">删除</text>
    </view>
  </view>

  <!-- 删除确认 -->
  <view class="confirm-overlay {{showDeleteDialog ? 'show' : ''}}" bind:tap="onCancelDelete">
    <view class="confirm-dialog" catch:tap="onStopPropagation">
      <text class="confirm-title">确认删除</text>
      <text class="confirm-message">删除后无法恢复，确定要删除吗？</text>
      <view class="confirm-actions">
        <view class="confirm-button cancel" bind:tap="onCancelDelete">
          <text class="button-text">取消</text>
        </view>
        <view class="confirm-button delete" bind:tap="onConfirmDelete">
          <text class="button-text">删除</text>
        </view>
      </view>
    </view>
  </view>
</view>