<!--AI搜索页面-->
<view class="ai-search-page {{themeClass}}">
  <!-- 搜索容器 -->
  <view class="search-container">
    <view class="search-input-wrapper">
      <input 
        class="search-input"
        value="{{searchQuery}}"
        placeholder="描述你要找的联系人，例如：上海做投资的朋友"
        placeholder-class="search-placeholder"
        bindinput="onSearchChange"
        bindconfirm="onSearchSubmit"
        bindfocus="onSearchFocus"
        bindblur="onSearchBlur"
      />
      <view class="search-action" bind:tap="onSearchSubmit">
        <text class="search-action-text">搜索</text>
      </view>
    </view>
    
    <!-- 搜索提示 -->
    <view class="search-hint">
      <text class="hint-text">试试自然语言搜索，AI会帮你精准定位</text>
    </view>
  </view>

  <!-- 搜索建议区域 -->
  <view class="suggestions-container" wx:if="{{!hasSearched}}">
    <!-- 搜索建议 -->
    <view class="suggestions-section">
      <text class="section-label">搜索建议</text>
      <view class="suggestion-list">
        <view
          wx:for="{{suggestions}}"
          wx:key="index"
          class="suggestion-item"
          bind:tap="onSuggestionTap"
          data-text="{{item}}"
        >
          <text class="suggestion-text">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- 搜索历史 -->
    <view class="history-section" wx:if="{{searchHistory.length > 0}}">
      <view class="section-header">
        <text class="section-label">搜索历史</text>
        <text class="clear-history" bind:tap="onClearHistory">清除</text>
      </view>
      <view class="history-list">
        <view
          wx:for="{{searchHistory}}"
          wx:key="index"
          class="history-item"
          bind:tap="onHistoryTap"
          data-text="{{item}}"
        >
          <text class="history-text">{{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 搜索结果区域 -->
  <view class="results-container" wx:if="{{hasSearched}}">
    <!-- 搜索查询展示 -->
    <view class="search-query-bar">
      <text class="query-text">搜索：{{lastSearchQuery}}</text>
      <text class="result-count">找到 {{searchResults.length}} 个结果</text>
    </view>

    <!-- 加载状态 -->
    <view class="loading-state" wx:if="{{searching}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">AI正在分析中...</text>
    </view>

    <!-- 搜索结果列表 -->
    <view class="results-list" wx:if="{{!searching && searchResults.length > 0}}">
      <!-- AI分析摘要 -->
      <view class="ai-analysis" wx:if="{{aiAnalysis}}">
        <view class="analysis-header">
          <text class="analysis-title">AI 分析</text>
        </view>
        <text class="analysis-content">{{aiAnalysis}}</text>
      </view>

      <!-- 联系人结果 -->
      <view class="result-cards">
        <view 
          wx:for="{{searchResults}}"
          wx:key="id"
          class="result-card {{item.isHighMatch ? 'high-match' : ''}}"
          bind:tap="onContactTap"
          data-contact="{{item}}"
        >
          <view class="card-main">
            <view class="card-avatar">
              <text class="avatar-text">{{item.initial}}</text>
            </view>
            
            <view class="card-content">
              <view class="card-header">
                <text class="contact-name">{{item.displayName}}</text>
                <text 
                  wx:if="{{item.isHighMatch}}"
                  class="match-badge"
                >
                  高匹配
                </text>
              </view>
              
              <text class="contact-info" wx:if="{{item.company || item.position}}">
                {{item.company}}{{item.company && item.position ? ' · ' : ''}}{{item.position}}
              </text>
              
              <view class="contact-tags" wx:if="{{item.formattedTags.length > 0}}">
                <view 
                  wx:for="{{item.formattedTags}}"
                  wx:key="*this"
                  wx:for-item="tag"
                  class="tag-wrapper"
                >
                  <text class="tag-text">{{tag}}</text>
                </view>
              </view>
              
              <text class="contact-summary" wx:if="{{item.ai_summary}}">
                {{item.ai_summary}}
              </text>
            </view>
          </view>
          
          <view class="card-footer">
            <view class="match-score">
              <text class="score-text">匹配度: {{item.matchScore * 100}}%</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 空结果状态 -->
    <view class="empty-state" wx:if="{{!searching && searchResults.length === 0}}">
      <text class="empty-title">没有找到相关联系人</text>
      <text class="empty-desc">换个关键词试试，或者使用更详细的描述</text>
      <view
        class="empty-action"
        bind:tap="onTryOtherSearch"
      >
        <text class="action-text">重新搜索</text>
      </view>
    </view>
  </view>

  <!-- 快速访问区域 -->
  <view class="quick-access" wx:if="{{!hasSearched && !searchFocused}}">
    <text class="section-label">快速访问</text>
    <view class="quick-grid">
      <view class="quick-item" bind:tap="onQuickSearch" data-query="最近添加">
        <text class="quick-text">最近添加</text>
      </view>
      <view class="quick-item" bind:tap="onQuickSearch" data-query="重要客户">
        <text class="quick-text">重要客户</text>
      </view>
      <view class="quick-item" bind:tap="onQuickSearch" data-query="投资人">
        <text class="quick-text">投资人</text>
      </view>
      <view class="quick-item" bind:tap="onQuickSearch" data-query="合作伙伴">
        <text class="quick-text">合作伙伴</text>
      </view>
    </view>
  </view>

  <!-- 搜索帮助 -->
  <view class="search-help" wx:if="{{!hasSearched && !searchFocused}}">
    <text class="section-label">搜索技巧</text>
    <view class="help-content">
      <view class="help-item">• 可以使用自然语言描述，如"做教育的朋友"</view>
      <view class="help-item">• 支持多条件组合，如"上海 投资 本科"</view>
      <view class="help-item">• AI会理解语义，找出最相关的联系人</view>
    </view>
  </view>

  <!-- 自定义TabBar -->
  <custom-tabbar current="ai-search" />
</view>