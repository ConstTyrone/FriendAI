<!--å…³ç³»åˆ—è¡¨é¡µé¢-->
<scroll-view class="relationship-list-page {{themeClass}}" scroll-y="{{true}}" bindscroll="onPageScroll" enhanced="{{true}}" show-scrollbar="{{false}}">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-top">
      <text class="back-button" bindtap="onBack">â€¹ è¿”å›</text>
      <text class="page-title">{{contactName}}çš„å…³ç³»</text>
    </view>
    
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-section" wx:if="{{stats.total_relationships > 0}}">
      <view class="stat-item">
        <text class="stat-number">{{stats.total_relationships}}</text>
        <text class="stat-label">æ€»å…³ç³»</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.confirmed_relationships}}</text>
        <text class="stat-label">å·²ç¡®è®¤</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.discovered_relationships}}</text>
        <text class="stat-label">å¾…ç¡®è®¤</text>
      </view>
    </view>
  </view>
  
  <!-- ç­›é€‰å’Œæ’åº -->
  <view class="filter-section" wx:if="{{relationships.length > 0}}">
    <view class="filter-tabs">
      <view 
        class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-filter="all"
      >
        <text class="tab-text">å…¨éƒ¨</text>
      </view>
      <view 
        class="filter-tab {{currentFilter === 'discovered' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-filter="discovered"
      >
        <text class="tab-text">å¾…ç¡®è®¤</text>
      </view>
      <view 
        class="filter-tab {{currentFilter === 'confirmed' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-filter="confirmed"
      >
        <text class="tab-text">å·²ç¡®è®¤</text>
      </view>
    </view>
    
    <!-- è§†å›¾åˆ‡æ¢ -->
    <view class="view-toggle-section">
      <view class="view-toggle">
        <view class="toggle-button active">
          <t-icon name="format-list-bulleted" size="32rpx" />
          <text class="toggle-text">åˆ—è¡¨</text>
        </view>
        <view class="toggle-button" bindtap="onSwitchToGraph">
          <t-icon name="chart-bubble" size="32rpx" />
          <text class="toggle-text">å›¾è°±</text>
        </view>
      </view>
    </view>
    
    <!-- æ’åºé€‰é¡¹ -->
    <view class="sort-section">
      <text class="sort-label">æ’åºï¼š</text>
      <picker 
        bindchange="onSortChange"
        value="{{currentSortIndex}}"
        range="{{sortOptions}}"
        range-key="label"
      >
        <view class="sort-picker">
          <text class="sort-text">{{sortOptions[currentSortIndex].label}}</text>
          <t-icon name="chevron-down" size="24rpx" color="var(--td-text-color-secondary, #757575)" />
        </view>
      </picker>
    </view>
  </view>
  
  <!-- å…³ç³»åˆ—è¡¨ -->
  <view class="relationships-container" wx:if="{{filteredRelationships.length > 0}}">
    <view wx:for="{{filteredRelationships}}" wx:key="id" class="relationship-item">
      <relationship-card
        relationship="{{item}}"
        sourceProfile="{{item.sourceProfile}}"
        targetProfile="{{item.targetProfile}}"
        showEvidence="{{true}}"
        showActions="{{true}}"
        bind:cardTap="onRelationshipTap"
        bind:confirm="onConfirmRelationship"
        bind:ignore="onIgnoreRelationship"
      />
    </view>
  </view>
  
  <!-- æ‰¹é‡æ“ä½œ -->
  <view class="batch-actions" wx:if="{{hasUncofirmedRelationships}}">
    <view class="batch-buttons">
      <button 
        class="batch-btn primary" 
        bindtap="onBatchConfirm"
        disabled="{{batchProcessing}}"
      >
        <t-loading wx:if="{{batchProcessing}}" theme="spinner" size="40rpx" />
        <text class="btn-text">{{batchProcessing ? 'å¤„ç†ä¸­...' : 'å…¨éƒ¨ç¡®è®¤'}}</text>
      </button>
      <button 
        class="batch-btn secondary" 
        bindtap="onBatchIgnore"
        disabled="{{batchProcessing}}"
      >
        <text class="btn-text">å…¨éƒ¨å¿½ç•¥</text>
      </button>
    </view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && filteredRelationships.length === 0}}">
    <view class="empty-icon">
      <text class="icon-text">ğŸ”—</text>
    </view>
    <text class="empty-title">{{getEmptyTitle()}}</text>
    <text class="empty-desc">{{getEmptyDescription()}}</text>
    
    <!-- é‡æ–°åˆ†ææŒ‰é’® -->
    <button 
      class="reanalyze-btn" 
      bindtap="onReanalyze"
      wx:if="{{currentFilter === 'all'}}"
    >
      <t-icon name="refresh" size="28rpx" color="#0052d9" />
      <text class="btn-text">é‡æ–°åˆ†æå…³ç³»</text>
    </button>
  </view>
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <t-loading theme="spinner" size="60rpx" />
    <text class="loading-text">åŠ è½½å…³ç³»æ•°æ®ä¸­...</text>
  </view>
  
  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{error && !loading}}">
    <text class="error-message">{{error}}</text>
    <button class="retry-btn" bindtap="loadRelationships">
      <text class="btn-text">é‡æ–°åŠ è½½</text>
    </button>
  </view>
</scroll-view>