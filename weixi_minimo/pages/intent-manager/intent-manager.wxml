<!--æ„å›¾ç®¡ç†é¡µé¢-->
<view class="intent-page {{themeClass}}">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="top-bar">
    <text class="page-title">æˆ‘çš„æ„å›¾</text>
    <view class="create-btn" bindtap="showCreateDialog">
      <text class="btn-icon">âœ¨</text>
      <text class="btn-text">åˆ›å»ºæ„å›¾</text>
    </view>
  </view>
  
  <!-- æ„å›¾ç»Ÿè®¡ - ç°ä»£åŒ–è®¾è®¡ -->
  <view class="stats-card">
    <view class="stat-item">
      <text class="stat-value">{{stats.activeCount}}</text>
      <text class="stat-label">ğŸ¯ æ´»è·ƒæ„å›¾</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{stats.totalMatches}}</text>
      <text class="stat-label">ğŸ¤ ç´¯è®¡åŒ¹é…</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{stats.todayPush}}</text>
      <text class="stat-label">ğŸ“¨ ä»Šæ—¥æ¨é€</text>
    </view>
  </view>
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading && intents.length === 0}}" class="loading-state">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <!-- æ„å›¾åˆ—è¡¨ -->
  <view wx:if="{{!loading || intents.length > 0}}" class="intent-list">
    <view wx:for="{{intents}}" wx:key="id" class="intent-card" 
          bindtap="viewMatches" data-id="{{item.id}}">
      <view class="intent-header">
        <view class="intent-info">
          <text class="intent-name">{{item.name}}</text>
          <text class="intent-type">{{item.typeLabel}}</text>
        </view>
        <switch checked="{{item.status === 'active'}}" 
                bindchange="toggleIntent" 
                data-id="{{item.id}}"
                catchtap="stopPropagation"/>
      </view>
      
      <text class="intent-desc">{{item.description}}</text>
      
      <view class="intent-tags" wx:if="{{item.keywordsList.length > 0 && item.keywordsList.length <= 5}}">
        <text wx:for="{{item.keywordsList}}" wx:for-item="keyword" wx:key="*this"
              class="keyword-tag">{{keyword}}</text>
      </view>
      
      <view class="intent-meta">
        <text class="meta-item">åŒ¹é…åº¦: {{item.thresholdPercent}}%</text>
        <text class="meta-item">{{item.priorityLabel}}ä¼˜å…ˆçº§</text>
      </view>
      
      <view class="intent-footer">
        <text class="match-info">åŒ¹é… {{item.match_count || 0}} äºº</text>
        <view class="intent-actions">
          <text class="action-link" catchtap="editIntent" 
                data-id="{{item.id}}">ç¼–è¾‘</text>
          <text class="action-link danger" catchtap="deleteIntent" 
                data-id="{{item.id}}">åˆ é™¤</text>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{intents.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ¯</text>
      <text class="empty-title">è¿˜æ²¡æœ‰åˆ›å»ºæ„å›¾</text>
      <text class="empty-desc">åˆ›å»ºæ„å›¾åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºä½ åŒ¹é…åˆé€‚çš„è”ç³»äºº</text>
      <view class="empty-action" bindtap="showCreateDialog">
        <text class="action-text">åˆ›å»ºç¬¬ä¸€ä¸ªæ„å›¾</text>
      </view>
    </view>
  </view>
  
  <!-- é‡æ–°åŒ¹é…æç¤º -->
  <view wx:if="{{showMatchingHint}}" class="matching-hint">
    <view class="hint-content">
      <view class="hint-icon">
        <view class="spinning-icon"></view>
      </view>
      <text class="hint-text">{{matchingHintText}}</text>
    </view>
  </view>
  
  <!-- åˆ›å»º/ç¼–è¾‘æ„å›¾å¯¹è¯æ¡† -->
  <view class="dialog-overlay {{showCreateDialog ? 'show' : ''}}" 
        catchtap="hideCreateDialog">
    <view class="dialog-content" catchtap="stopPropagation">
      <text class="dialog-title">{{editMode ? 'ç¼–è¾‘æ„å›¾' : 'åˆ›å»ºæ–°æ„å›¾'}}</text>
      
      <!-- å¯æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
      <scroll-view class="dialog-scroll-content" scroll-y="{{true}}">
        <!-- åˆ›å»ºæ–¹å¼é€‰æ‹©ï¼ˆç¼–è¾‘æ¨¡å¼ä¸‹éšè—ï¼‰ -->
        <view class="create-mode-tabs" wx:if="{{!editMode}}">
          <text class="tab {{createMode === 'natural' ? 'active' : ''}}"
                bindtap="switchMode" data-mode="natural">è‡ªç„¶è¯­è¨€</text>
          <text class="tab {{createMode === 'template' ? 'active' : ''}}"
                bindtap="switchMode" data-mode="template">ä½¿ç”¨æ¨¡æ¿</text>
        </view>
        
        <!-- è‡ªç„¶è¯­è¨€æ¨¡å¼ -->
        <view wx:if="{{createMode === 'natural'}}" class="natural-mode">
          <input class="intent-name-input" 
                 placeholder="ç»™æ„å›¾èµ·ä¸ªåå­—" 
                 value="{{formData.name}}"
                 bindinput="onInputChange"
                 data-field="name"/>
          <textarea class="intent-desc-input" 
                    placeholder="ç”¨ä¸€æ®µè¯æè¿°ä½ æƒ³æ‰¾ä»€ä¹ˆæ ·çš„äººï¼Œæ¯”å¦‚ï¼šå¯»æ‰¾åœ¨åŒ—äº¬çš„AIæŠ€æœ¯ä¸“å®¶ï¼Œæœ‰åˆ›ä¸šç»éªŒï¼Œå¯ä»¥åšæŠ€æœ¯åˆä¼™äºº"
                    value="{{formData.description}}"
                    bindinput="onInputChange"
                    data-field="description"
                    maxlength="200"/>
          <view class="ai-tips">
            <text class="tips-icon">ğŸ’¡</text>
            <text class="tips-text">AIä¼šè‡ªåŠ¨ç†è§£ä½ çš„éœ€æ±‚å¹¶è®¾ç½®åŒ¹é…æ¡ä»¶</text>
          </view>
        </view>
        
        <!-- æ¨¡æ¿æ¨¡å¼ -->
        <view wx:if="{{createMode === 'template'}}" class="template-mode">
          <view wx:for="{{templates}}" wx:key="name" class="template-item" 
                bindtap="selectTemplate" data-index="{{index}}">
            <text class="template-name">{{item.name}}</text>
            <text class="template-desc">{{item.description}}</text>
            <text class="template-example">ç¤ºä¾‹ï¼š{{item.template}}</text>
          </view>
        </view>
        
        <!-- é…ç½®é¡¹ -->
        <view class="config-section">
          <view class="config-item">
            <text class="config-label">åŒ¹é…é˜ˆå€¼</text>
            <view class="config-control">
              <slider min="50" max="95" value="{{formData.threshold}}" 
                      bindchange="onThresholdChange"
                      bindchanging="onThresholdChanging"
                      block-size="20"
                      block-color="{{theme === 'dark' ? '#06ae56' : '#000000'}}"
                      activeColor="{{theme === 'dark' ? '#06ae56' : '#000000'}}"/>
              <text class="config-value">{{formData.threshold}}%</text>
            </view>
          </view>
          
          <view class="config-item">
            <text class="config-label">ä¼˜å…ˆçº§</text>
            <picker range="{{priorityOptions}}" value="{{formData.priority - 1}}"
                    bindchange="onPriorityChange">
              <view class="picker-value">
                {{priorityOptions[formData.priority - 1]}}
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
          
          <view class="config-item">
            <text class="config-label">æ„å›¾ç±»å‹</text>
            <picker range="{{typeOptions}}" range-key="label" 
                    value="{{typeIndex}}"
                    bindchange="onTypeChange">
              <view class="picker-value">
                {{typeOptions[typeIndex].label}}
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
          
          <view class="config-item">
            <text class="config-label">æ¯æ—¥æ¨é€ä¸Šé™</text>
            <input type="number" 
                   value="{{formData.maxPushPerDay}}"
                   bindinput="onInputChange"
                   data-field="maxPushPerDay"
                   class="config-input"/>
          </view>
        </view>
      </scroll-view>
      
      <!-- å¯¹è¯æ¡†æŒ‰é’® -->
      <view class="dialog-actions">
        <view class="cancel-btn" bindtap="hideCreateDialog">å–æ¶ˆ</view>
        <view class="confirm-btn" bindtap="saveIntent">{{editMode ? 'ä¿å­˜' : 'åˆ›å»º'}}</view>
      </view>
    </view>
  </view>
  
  <!-- åº•éƒ¨TabBar -->
  <custom-tabbar current="intent-manager" />
</view>