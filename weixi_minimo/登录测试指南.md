# 微信小程序登录测试指南

## 🎉 好消息
后端已经配置了小程序的 AppSecret，现在可以使用真正的微信登录了！

## 登录方式

### 1. 微信一键登录（推荐）
- 点击"微信一键登录"按钮
- 系统会自动：
  1. 调用 `wx.login()` 获取 code
  2. 将 code 发送给后端
  3. 后端使用 code 调用微信 API 获取你的 OpenID
  4. 使用 OpenID 创建或匹配用户
  5. 返回登录成功

### 2. 手动输入微信ID（备用）
- 如果你知道某个用户的 OpenID
- 可以手动输入进行登录
- 适合测试特定用户的数据

## 测试步骤

1. **确保后端服务正在运行**
   ```bash
   cd D:\My project\qiwei
   python run.py
   ```

2. **重新编译小程序**
   - 在微信开发者工具中点击"编译"

3. **点击"微信一键登录"**
   - 在开发者工具中会使用模拟的 code
   - 在真机上会使用真实的微信账号

## 注意事项

### 开发者工具
- 开发者工具中的 code 是模拟的
- 后端会检测到错误码 40029（无效的code）
- 自动使用测试用户 `dev_user_001`

### 真机测试
- 使用"预览"或"真机调试"
- 会获取真实的 OpenID
- 每个微信用户都有唯一的 OpenID

## 查看登录信息

登录成功后，在设置页面可以看到：
- **微信ID**：你的 OpenID（类似 `oXXXXXXXXXXXXXXXXXXXXXXX`）
- **系统ID**：后端数据库中的用户ID
- **登录时间**：登录的时间戳

## 常见问题

### Q: 为什么开发者工具中总是登录为 dev_user_001？
A: 开发者工具的 code 是模拟的，微信 API 无法识别。后端自动使用测试账户。

### Q: 如何在开发者工具中测试不同用户？
A: 使用"手动输入微信ID"功能，输入不同的 OpenID。

### Q: 真机上登录失败怎么办？
A: 检查：
1. 后端服务是否正常运行
2. 网络是否可以访问后端地址
3. 查看控制台的错误信息

## 后端日志

登录时，后端会输出详细日志：
```
使用微信code登录: 0a1Moh1w3Rzwp53gEM0w36vwR43Moh1c
微信登录成功，获取到openid: oXXXXXXXXXXXXXXXXXXXXXXX
```

如果是开发环境：
```
微信API错误: invalid code (code: 40029)
检测到开发环境模拟code，使用测试用户ID
```